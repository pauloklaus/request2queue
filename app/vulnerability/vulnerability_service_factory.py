import os
from logging import Logger

from app.infra.sns_handler import SnsHandler
from app.infra.sns_local_handler import SnsLocalHandler
from vulnerability.vulnerability_service import VulnerabilityService
from vulnerability.vulnerability_sns_repository import VulnerabilitySnsRepository

def vulnerability_service_factory(logger: Logger):
    sns_topic = os.getenv("SNS_TOPIC")
    environment = os.getenv("ENVIRONMENT")

    sns_client = SnsLocalHandler(sns_topic) if environment == "local" else SnsHandler(sns_topic)
    sns_repository = VulnerabilitySnsRepository(sns_client, logger)
    return VulnerabilityService(sns_repository, logger)
